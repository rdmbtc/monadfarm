<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ MonFarm Amazing Social Hub - Real-time Collaboration</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script type="module" crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/react@18/+esm"></script>
    <script type="module" crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/react-dom@18/+esm"></script>
    <script type="module" crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/react-together@latest/+esm"></script>
    <style>
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            25% { filter: hue-rotate(90deg); }
            50% { filter: hue-rotate(180deg); }
            75% { filter: hue-rotate(270deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
                transform: translate3d(0, -30px, 0);
            }
            70% {
                animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
                transform: translate3d(0, -15px, 0);
            }
            90% {
                transform: translate3d(0,-4px,0);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="module">
        import React, { useState, useCallback, useEffect } from 'https://cdn.jsdelivr.net/npm/react@18/+esm';
        import ReactDOM from 'https://cdn.jsdelivr.net/npm/react-dom@18/+esm';
        import { 
            ReactTogether, 
            useStateTogether, 
            useStateTogetherWithPerUserValues, 
            useFunctionTogether, 
            useChat, 
            useCursors, 
            useConnectedUsers, 
            useNicknames, 
            useMyId, 
            useIsTogether, 
            useJoinUrl, 
            useCreateRandomSession, 
            useLeaveSession, 
            Chat, 
            Cursors, 
            ConnectedUsers, 
            SessionManager, 
            HoverHighlighter, 
            utils 
        } from 'https://cdn.jsdelivr.net/npm/react-together@latest/+esm';

        const { createElement: h, Fragment } = React;

        // Amazing Social Hub Component
        function AmazingSocialHub() {
            return h(ReactTogether, {
                sessionParams: {
                    appId: 'com.monfarm.social',
                    apiKey: '2lHj0hCmiJV7bFST0P1aqGGUmkSDB4VqULXCwejXVX',
                    name: 'monfarm-social-hub',
                },
                rememberUsers: true
            }, 
                h('div', { className: "min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white" },
                    h(SocialHubContent),
                    h(Cursors, { options: { omitMyValue: false } })
                )
            );
        }

        function SocialHubContent() {
            const isTogether = useIsTogether();
            const joinUrl = useJoinUrl();
            const connectedUsers = useConnectedUsers();
            const [myNickname, setMyNickname, allNicknames] = useNicknames();
            const myId = useMyId();
            const createRandomSession = useCreateRandomSession();
            const leaveSession = useLeaveSession();

            // Shared state for the social hub
            const [currentView, setCurrentView] = useStateTogether('current-view', 'feed');
            const [globalMessage, setGlobalMessage] = useStateTogether('global-message', 'ðŸŽ‰ Welcome to MonFarm Social Hub!');
            
            // Per-user states
            const [myStatus, setMyStatus, allStatuses] = useStateTogetherWithPerUserValues('user-status', 'ðŸŒŸ Online');
            const [myMood, setMyMood, allMoods] = useStateTogetherWithPerUserValues('user-mood', 'ðŸ˜Š');
            const [myActivity, setMyActivity, allActivities] = useStateTogetherWithPerUserValues('user-activity', 'Exploring');

            // Social posts state
            const [posts, setPosts] = useStateTogether('social-posts', []);
            const [likes, setLikes] = useStateTogether('post-likes', {});

            // Global notification system
            const showGlobalNotification = useFunctionTogether('global-notification', 
                useCallback((message, sender) => {
                    const notification = document.createElement('div');
                    notification.className = 'fixed top-4 right-4 bg-yellow-500 text-black px-6 py-3 rounded-lg shadow-lg z-50 animate-bounce';
                    notification.innerHTML = `<strong>${sender}:</strong> ${message}`;
                    document.body.appendChild(notification);
                    setTimeout(() => document.body.removeChild(notification), 5000);
                }, [])
            );

            // Party mode function
            const triggerPartyMode = useFunctionTogether('party-mode',
                useCallback(() => {
                    document.body.style.animation = 'rainbow 2s infinite';
                    setTimeout(() => {
                        document.body.style.animation = '';
                    }, 5000);
                }, [])
            );

            const addPost = useCallback((content) => {
                const newPost = {
                    id: Date.now() + Math.random(),
                    author: myNickname || myId || 'Anonymous',
                    authorId: myId,
                    content,
                    timestamp: Date.now(),
                    mood: myMood
                };
                setPosts(prev => [newPost, ...prev]);
            }, [myNickname, myId, myMood, setPosts]);

            const likePost = useCallback((postId) => {
                setLikes(prev => ({
                    ...prev,
                    [postId]: (prev[postId] || 0) + 1
                }));
            }, [setLikes]);

            if (!isTogether) {
                return h('div', { className: "flex items-center justify-center min-h-screen" },
                    h('div', { className: "text-center" },
                        h('div', { className: "animate-spin rounded-full h-32 w-32 border-b-2 border-white mx-auto mb-4" }),
                        h('h2', { className: "text-2xl font-bold mb-4" }, 'Connecting to MonFarm Social Hub...'),
                        h('button', { 
                            onClick: createRandomSession,
                            className: "bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-semibold transition-colors"
                        }, 'Create New Session')
                    )
                );
            }

            return h('div', { className: "container mx-auto px-4 py-6" },
                // Header
                h('header', { className: "flex justify-between items-center mb-8 bg-black/20 backdrop-blur-sm rounded-xl p-6" },
                    h('div', null,
                        h('h1', { className: "text-4xl font-bold bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent" },
                            'ðŸš€ MonFarm Social Hub'
                        ),
                        h('p', { className: "text-purple-200 mt-2" }, globalMessage)
                    ),
                    h('div', { className: "flex items-center gap-4" },
                        h(ConnectedUsers, { maxAvatars: 5 }),
                        h(SessionManager)
                    )
                ),

                // User Profile Section
                h('div', { className: "bg-black/20 backdrop-blur-sm rounded-xl p-6 mb-6" },
                    h('h3', { className: "text-xl font-bold mb-4" }, 'ðŸ‘¤ Your Profile'),
                    h('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                        h('div', null,
                            h('label', { className: "block text-sm font-medium mb-2" }, 'Nickname'),
                            h('input', {
                                type: "text",
                                value: myNickname,
                                onChange: (e) => setMyNickname(e.target.value),
                                className: "w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",
                                placeholder: "Enter your nickname"
                            })
                        ),
                        h('div', null,
                            h('label', { className: "block text-sm font-medium mb-2" }, 'Status'),
                            h('input', {
                                type: "text",
                                value: myStatus,
                                onChange: (e) => setMyStatus(e.target.value),
                                className: "w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",
                                placeholder: "What's your status?"
                            })
                        ),
                        h('div', null,
                            h('label', { className: "block text-sm font-medium mb-2" }, 'Mood'),
                            h('select', {
                                value: myMood,
                                onChange: (e) => setMyMood(e.target.value),
                                className: "w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                            },
                                h('option', { value: "ðŸ˜Š" }, 'ðŸ˜Š Happy'),
                                h('option', { value: "ðŸ¤”" }, 'ðŸ¤” Thinking'),
                                h('option', { value: "ðŸŽ‰" }, 'ðŸŽ‰ Excited'),
                                h('option', { value: "ðŸ˜´" }, 'ðŸ˜´ Sleepy'),
                                h('option', { value: "ðŸ”¥" }, 'ðŸ”¥ On Fire'),
                                h('option', { value: "ðŸŒŸ" }, 'ðŸŒŸ Stellar')
                            )
                        )
                    )
                ),

                // Navigation
                h('nav', { className: "flex gap-2 mb-6 bg-black/20 backdrop-blur-sm rounded-xl p-2" },
                    ['feed', 'chat', 'users'].map((view) =>
                        h('button', {
                            key: view,
                            onClick: () => setCurrentView(view),
                            className: `px-4 py-2 rounded-lg font-medium transition-colors capitalize ${
                                currentView === view 
                                    ? 'bg-purple-600 text-white' 
                                    : 'text-purple-200 hover:bg-white/10'
                            }`
                        }, 
                            `${view === 'feed' ? 'ðŸ“±' : view === 'chat' ? 'ðŸ’¬' : 'ðŸ‘¥'} ${view}`
                        )
                    )
                ),

                // Content Area
                h('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" },
                    h('div', { className: "lg:col-span-2" },
                        currentView === 'feed' && h(SocialFeed, { posts, likes, addPost, likePost }),
                        currentView === 'chat' && h(ChatSection),
                        currentView === 'users' && h(UsersSection, { allStatuses, allMoods, allNicknames })
                    ),

                    // Sidebar
                    h('div', { className: "space-y-6" },
                        h(LiveActivity, { allActivities }),
                        h(QuickActions, { 
                            showGlobalNotification, 
                            triggerPartyMode,
                            myNickname,
                            setGlobalMessage
                        }),
                        h(ShareSection, { joinUrl })
                    )
                )
            );
        }

        // Social Feed Component
        function SocialFeed({ posts, likes, addPost, likePost }) {
            const [newPost, setNewPost] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (newPost.trim()) {
                    addPost(newPost);
                    setNewPost('');
                }
            };

            return h('div', { className: "bg-black/20 backdrop-blur-sm rounded-xl p-6" },
                h('h2', { className: "text-2xl font-bold mb-4" }, 'ðŸ“± Social Feed'),
                
                // Post Creation
                h('form', { onSubmit: handleSubmit, className: "mb-6" },
                    h('textarea', {
                        value: newPost,
                        onChange: (e) => setNewPost(e.target.value),
                        placeholder: "Share something amazing with the community...",
                        className: "w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none",
                        rows: 3
                    }),
                    h('button', {
                        type: "submit",
                        className: "mt-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-6 py-2 rounded-lg font-semibold transition-all transform hover:scale-105"
                    }, 'ðŸš€ Share Post')
                ),

                // Posts
                h('div', { className: "space-y-4 max-h-96 overflow-y-auto" },
                    posts.map((post) =>
                        h(HoverHighlighter, { 
                            key: post.id, 
                            rtKey: `post-${post.id}`, 
                            className: "hover:bg-white/5 transition-colors" 
                        },
                            h('div', { className: "bg-white/5 rounded-lg p-4 border border-white/10" },
                                h('div', { className: "flex items-center justify-between mb-2" },
                                    h('div', { className: "flex items-center gap-2" },
                                        h('span', { className: "font-semibold text-purple-300" }, post.author),
                                        h('span', { className: "text-2xl" }, post.mood)
                                    ),
                                    h('span', { className: "text-xs text-gray-400" },
                                        new Date(post.timestamp).toLocaleTimeString()
                                    )
                                ),
                                h('p', { className: "text-white mb-3" }, post.content),
                                h('button', {
                                    onClick: () => likePost(post.id),
                                    className: "flex items-center gap-2 text-pink-400 hover:text-pink-300 transition-colors"
                                }, `â¤ï¸ ${likes[post.id] || 0} likes`)
                            )
                        )
                    )
                )
            );
        }

        // Chat Section Component
        function ChatSection() {
            return h('div', { className: "bg-black/20 backdrop-blur-sm rounded-xl p-6" },
                h('h2', { className: "text-2xl font-bold mb-4" }, 'ðŸ’¬ Live Chat'),
                h('div', { className: "h-96" },
                    h(Chat, { 
                        rtKey: "main-chat", 
                        chatName: "ðŸŒŸ MonFarm Community Chat",
                        className: "h-full"
                    })
                )
            );
        }

        // Users Section Component  
        function UsersSection({ allStatuses, allMoods, allNicknames }) {
            const connectedUsers = useConnectedUsers();

            return h('div', { className: "bg-black/20 backdrop-blur-sm rounded-xl p-6" },
                h('h2', { className: "text-2xl font-bold mb-4" }, 'ðŸ‘¥ Community Members'),
                h('div', { className: "space-y-3 max-h-96 overflow-y-auto" },
                    connectedUsers.map((user) =>
                        h(HoverHighlighter, { key: user.userId, rtKey: `user-${user.userId}` },
                            h('div', { className: "bg-white/5 rounded-lg p-4 border border-white/10" },
                                h('div', { className: "flex items-center justify-between" },
                                    h('div', { className: "flex items-center gap-3" },
                                        h('div', { 
                                            className: "w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold",
                                            style: { backgroundColor: utils.getUserColor(user.userId) }
                                        }, allMoods[user.userId] || 'ðŸ˜Š'),
                                        h('div', null,
                                            h('h3', { className: "font-semibold text-purple-300" },
                                                `${user.nickname} ${user.isYou ? '(You)' : ''}`
                                            ),
                                            h('p', { className: "text-sm text-gray-400" },
                                                allStatuses[user.userId] || 'ðŸŒŸ Online'
                                            )
                                        )
                                    ),
                                    h('div', { className: "w-3 h-3 bg-green-400 rounded-full animate-pulse" })
                                )
                            )
                        )
                    )
                )
            );
        }

        // Live Activity Component
        function LiveActivity({ allActivities }) {
            const connectedUsers = useConnectedUsers();
            
            return h('div', { className: "bg-black/20 backdrop-blur-sm rounded-xl p-6" },
                h('h3', { className: "text-xl font-bold mb-4" }, 'âš¡ Live Activity'),
                h('div', { className: "space-y-2 max-h-48 overflow-y-auto" },
                    connectedUsers.slice(0, 5).map((user) =>
                        h('div', { 
                            key: user.userId, 
                            className: "flex items-center gap-3 p-2 bg-white/5 rounded-lg" 
                        },
                            h('div', { 
                                className: "w-8 h-8 rounded-full flex items-center justify-center text-sm",
                                style: { backgroundColor: utils.getUserColor(user.userId) }
                            }, user.nickname.charAt(0).toUpperCase()),
                            h('div', { className: "flex-1" },
                                h('p', { className: "text-sm font-medium" }, user.nickname),
                                h('p', { className: "text-xs text-gray-400" },
                                    allActivities[user.userId] || 'Exploring the hub'
                                )
                            ),
                            h('div', { className: "w-2 h-2 bg-green-400 rounded-full animate-pulse" })
                        )
                    )
                )
            );
        }

        // Quick Actions Component
        function QuickActions({ showGlobalNotification, triggerPartyMode, myNickname, setGlobalMessage }) {
            const [notificationText, setNotificationText] = useState('');
            const [newGlobalMessage, setNewGlobalMessage] = useState('');

            const sendNotification = () => {
                if (notificationText.trim()) {
                    showGlobalNotification(notificationText, myNickname || 'Anonymous');
                    setNotificationText('');
                }
            };

            const updateGlobalMessage = () => {
                if (newGlobalMessage.trim()) {
                    setGlobalMessage(newGlobalMessage);
                    setNewGlobalMessage('');
                }
            };

            return h('div', { className: "bg-black/20 backdrop-blur-sm rounded-xl p-6" },
                h('h3', { className: "text-xl font-bold mb-4" }, 'ðŸš€ Quick Actions'),
                
                h('div', { className: "space-y-4" },
                    // Global Notification
                    h('div', null,
                        h('label', { className: "block text-sm font-medium mb-2" }, 'Send Global Notification'),
                        h('div', { className: "flex gap-2" },
                            h('input', {
                                type: "text",
                                value: notificationText,
                                onChange: (e) => setNotificationText(e.target.value),
                                placeholder: "Notify everyone...",
                                className: "flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm"
                            }),
                            h('button', {
                                onClick: sendNotification,
                                className: "bg-yellow-600 hover:bg-yellow-700 px-3 py-2 rounded-lg font-semibold transition-colors text-sm"
                            }, 'ðŸ“¢')
                        )
                    ),

                    // Update Global Message
                    h('div', null,
                        h('label', { className: "block text-sm font-medium mb-2" }, 'Update Welcome Message'),
                        h('div', { className: "flex gap-2" },
                            h('input', {
                                type: "text",
                                value: newGlobalMessage,
                                onChange: (e) => setNewGlobalMessage(e.target.value),
                                placeholder: "New welcome message...",
                                className: "flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm"
                            }),
                            h('button', {
                                onClick: updateGlobalMessage,
                                className: "bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded-lg font-semibold transition-colors text-sm"
                            }, 'âœ¨')
                        )
                    ),

                    // Party Mode
                    h('button', {
                        onClick: triggerPartyMode,
                        className: "w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 px-4 py-3 rounded-lg font-semibold transition-all transform hover:scale-105"
                    }, 'ðŸŽ‰ PARTY MODE! ðŸŽ‰')
                )
            );
        }

        // Share Section Component
        function ShareSection({ joinUrl }) {
            const [copied, setCopied] = useState(false);

            const copyToClipboard = async () => {
                if (joinUrl) {
                    await navigator.clipboard.writeText(joinUrl);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                }
            };

            return h('div', { className: "bg-black/20 backdrop-blur-sm rounded-xl p-6" },
                h('h3', { className: "text-xl font-bold mb-4" }, 'ðŸ”— Share & Invite'),
                
                joinUrl ? h('div', { className: "space-y-3" },
                    h('p', { className: "text-sm text-gray-300" }, 'Invite friends to join this session:'),
                    h('div', { className: "flex gap-2" },
                        h('input', {
                            type: "text",
                            value: joinUrl,
                            readOnly: true,
                            className: "flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-sm"
                        }),
                        h('button', {
                            onClick: copyToClipboard,
                            className: `px-4 py-2 rounded-lg font-semibold transition-colors text-sm ${
                                copied 
                                    ? 'bg-green-600 text-white' 
                                    : 'bg-purple-600 hover:bg-purple-700'
                            }`
                        }, copied ? 'âœ…' : 'ðŸ“‹')
                    ),
                    h('p', { className: "text-xs text-gray-400" },
                        'Share this link with friends to collaborate in real-time!'
                    )
                ) : h('p', { className: "text-gray-400" }, 'Not connected to a session')
            );
        }

        // Render the app
        ReactDOM.render(h(AmazingSocialHub), document.getElementById('root'));
    </script>
</body>
</html>
